\section{Отслеживание контакта в случае \textit{mecanum} колеса}\label{sect:track_mecanum}

Обозначим угол между осью ролика и плоскостью колеса $\psi$. В конфигурации обычного омни-колеса этот угол равен нулю. Расширим алгоритм отслеживания контакта, описанный выше для случая $\psi = 0$ на конфигурацию \textit{mecanum}, $\psi > 0$. В этом случае, в первую очередь, отметим отличия в геометрической форме роликов. Каждый ролик -- это твердое тело, ограниченное поверхностью вращения некоторой кривой вокруг его оси. В случае $\psi = 0$ эта кривая -- дуга окружности, но при $\psi > 0$, для того, чтобы проекция внешней границы колеса с роликами на его плоскость оставалась окружностью, образующая кривая поверхности ролика становится алгебраической кривой четвертого порядка \cite{Gfrerrer2008}. Для полноты приведем ее параметризацию в координатах $Kxyz$ (см. рис.~\ref{Roller} в разделе~\ref{sect:track_omni}), указанную в \cite{Gfrerrer2008}. В качестве параметра используется угол поворота колеса $\chi \in \left[ -\ddfrac{\pi}{n}, \ddfrac{\pi}{n} \right]$:
\begin{eqnarray*}
    x(\chi) & = & r\ddfrac{\sin^2\psi}{\cos\psi}\mathrm{tg}\chi + l\cos\psi\sin\chi \\
    y(\chi) & = & -\sqrt{\sin^2\psi\mathrm{tg}^2\chi + 1}\left(l\cos\chi - r\right).
\end{eqnarray*}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.75\textwidth]{./content/pic/asy/pic_mecanum.png}
    % \asyinclude[width=0.75\textwidth]{./content/pic/asy/pic_mecanum.asy}
    \caption{Отслеживание контакта для колеса \textit{mecanum}}
    \label{fig:mecanum}
\end{figure}

% \input{content/parts/3_friction/2_mecanum_impl_old.tex}
\input{content/parts/3_friction/2_mecanum_impl_new.tex}

\textbf{Явный алгоритм отслеживания контакта}

Для полноты изложения, приведем еще один способ вычисления компонент радиуса-вектора ${\bf r}_{C}$ точки контакта $C$ или, точнее, точки ролика, ближайшей к опорной плоскости, предложенный С.Я.Степановым \cite{KosenkoGerasimov2015}. Способ заключается в применении следующего набора равенств (см. рис.~\ref{fig:mecanum}):
% Лучше всего этот способ иллюстрирует геометрическая схема на рис.~\ref{fig:figure3}.
% STEPANOV
% Во-первых, имеем
% $$
% {\bf r}_{P_B}={\bf r}_{O_B}+\overrightarrow{CD}+\overrightarrow{DG},\quad
% \overrightarrow{CD}=-m{\bf i}_2,\quad\overrightarrow{DG}=-h{\bf j}_1,
% $$
$$
{\bf r}_{C}={\bf r}_{K}+\overrightarrow{KD}+\overrightarrow{DC},\quad
\overrightarrow{KD}=-a{\bf i}_2,\quad\overrightarrow{DC}=-h{\bf j}_1,
$$
% STEPANOV
% где $m=R_1\sin q / \cos q/\cos\psi $, $h=R-R_1/\cos q$. 
% Здесь $q$ -- текущее значение угла отклонения вектора ${\bf r}_{O_A}-{\bf r}_{O_B}$ от 
где $a = r\ddfrac{\sin\chi}{\cos\chi\cos\psi}$, $h = l - \ddfrac{r}{\cos\chi}$. Здесь $\chi$ -- текущее значение угла отклонения вектора $\vec{c}$ из предыдущего раздела от 
вертикали. Таким образом,
$$
    \cos\chi = \vecrho \cdot \vec{\gamma}, \quad \sin\chi = 
    \left( \vec{\gamma} \times \vecrho \right) \cdot {\bf k}_1.
$$
% STEPANOV
% $$
% \cos q=\vecrho\cdot{\bf n}_A,\quad\sin q=
% \left({\bf n}_A\times\vecrho\right)\cdot {\bf k}_1.
% $$
% \begin{figure*}[H]
% \centerline{\includegraphics[scale=0.7]{content/parts/3_friction/mo2015/stepanov.png}}
% \caption{Явная схема отслеживания контакта}
% \label{fig:figure3}
% \end{figure*}
% STEPANOV
% Поясним рис.~\ref{fig:figure3} более детально.
% В части (а) приведена проекция колеса на его плоскость и соответственно, проекция ролика, находящегося в общем положении так, что его ось находится под углом к плоскости проекции.
% Далее, $G$ -- точка контакта между роликом и опорной горизонтальной плоскостью в настоящий момент, $m'$ -- отрезок $DC$ проекции оси ролика на плоскость колеса. Легко видеть, что длина этой проекции равна $m'=m\cos\psi$, поскольку ось ролика $AB$ повернута вокруг прямой $OC$ на угол $\psi$, см. вертикальное сечение, содержащее ось ролика в части (b).
% Таким образом, чтобу получить точку контакта $P_B$ ($G$ на рис.), нужно пройти два отрезка прямых от центра ролика $O_B$ ($C$ на рис.): (a)~отрезок $CD$ оси ролика длины $m$; 
% (b)~отрезок $DG$ вертикали длины $h$.
% Как было отмечено выше, все величины требуется явно выразить через известные координаты.
Кривая, образующая поверхность ролика, пересекает его ось в окрестности острия и продолжается далее (параметризация образующей кривой, поверхности ролика и сечения этой поверхности плоскостью, содержащей ось ролика, приведены в \cite{Gfrerrer2008}), в связи с чем
% Чтобы исключить <<перекрытие>> роликов, т.е. ситуацию, при которой два ролика могут находиться в контакте одновременно, более чем при одном (граничном) значении угла поворота колеса,
необходимо ограничить длины роликов величиной
$$
L=2l\ddfrac{\sin\ddfrac{\pi}{n}}{\cos\psi},
$$
где $\ddfrac{\pi}{n}$ -- половина угла раствора дуги окружности, ограничивающей проекцию ролика на плоскость колеса. При такой конструкции колеса переход колеса с одного ролика на другой происходит мгновенно.
% и при этом их концы оказываются усечены.
% Подробно форма кривой, образующей поверхность роликов, описана в \cite{Gfrerrer2008}.
Отметим, что при этом след колеса на плоскости имеет разрыв, поскольку точка контакта мгновенно переходит на противоположный <<борт>> колеса. Это обстоятельство, впрочем, не препятствует эффективному численному решению.

% Описанные алгоритмы отслеживания контакта дают практически одинаковые результаты, относительные различия между которыми имеют порядок $10^{-8}$. Предсказуемо, явный алгоритм быстрее приблизительно в $1.5$ раза.
