\section{Метод построения механической модели системы твердых тел}

Для описания динамики системы воспользуемся следующим формализмом \cite{Kosenko2006,Kosenko2007,KosenkoQuaternionRus}. Положение каждого твердого тела будем задавать радиусом-вектором центра масс тела $\vec{r}$ в неподвижной системе отсчета $OXYZ$, введенной в главе 1, и кватернионом $\vec{q}$, задающим ориентацию тела; распределение скоростей описывается скоростью центра масс $\vec{v}$ и угловой скоростью тела $\vec{\omega}$.
Динамика этого твердого тела описывается уравнениями Ньютона-Эйлера:
$$ m\dot{\vec{v}} = \vec{F} + \vec{R}, \quad \dot{\vec{r}} = \vec{v} $$
$$ J\dot{\vec{\omega}} + [ \vec{\omega}, J\vec{\omega} ] = \vec{M} + \vec{L}, \quad \dot{\vec{q}} = (0, \enspace \vec{\omega}), $$
где $\vec{F}$ и $\vec{R}$ -- главные векторы активных сил и реакций, $J$ -- тензор инерции в подвижной системе отсчета, связанной с телом, в $\dot{\vec{\omega}}$ производная по времени берется в подвижной системе отсчета, $\vec{M}$ и $\vec{L}$ -- главные векторы моментов, приложенных к телу, и реактивных моментов.

Для получения замкнутой системы уравнений требуется ввести также уравнения связей 
\begin{equation}\label{eq:mo_cstr}
    f(\vec{\underline{r}}, \vec{\underline{v}}, \vec{\underline{q}}, \vec{\underline{\omega}}) = 0,
\end{equation}
и модель реакций связей, в частности, контактного взаимодействия:
\begin{equation}\label{eq:mo_reac}
    g(\vec{\underline{R}}, \vec{\underline{r}}, \vec{\underline{v}}, \vec{\underline{L}}, \vec{\underline{q}}, \vec{\underline{\omega}}) = 0,
\end{equation}
где левые части зависят, вообще говоря, от величин, описывающих движение всех тел. Выражения в левых частях\upr{eq:mo_cstr} и\upr{eq:mo_reac} также могут быть кусочно-заданными, что и имеет место в задаче о движении омни-колеса, поскольку ролики входят и выходят из контакта с опроной поверхностью.

Отметим, что при необходимости изменения закона контактного взаимодействия достаточно изменить только уравнения\upr{eq:mo_reac}.

В построенной системе дифференциально-алгебраических уравнений используются избыточные координаты, а дифференциальные уравнения, вообще говоря, не разрешены относительно первых производных фазовых переменных. Для эффективного численного интегрирования такой системы требуется \cite{kosenkoBook2012modelirovanie} представить ее в виде

$$ A(\vec{x}, t)\dot{\vec{x}} = \vec{G}(\vec{x}, t), $$

где вектор $\vec{x}$ составлен из фазовых переменных и множителей Лагранжа, матрица $A$ -- квадратная.
Это может быть сделано в полуавтоматическом режиме с помощью инструментов инфраструктуры языка \texttt{Modelica}. Эти инструменты (см., например, \cite{Fritzson}) выполняют редукцию индекса построенной системы дифференциально-алгебраических уравнений и строят разностную схему численного решения.

Рассматриваемая в этой главе система голономна, но ее связи не идеальны. Количество степеней свободы системы равно
$$ 3 + N(n + 1),$$
а количество дифференциальных уравнений движения твердых тел, поступающих на вход алгоритмам инструментов \texttt{Modelica} -- $(3 + N(n + 1)) \cdot 7$, что для экипажа с тремя колесами и четырьмя роликами на каждом составляет $208$. Кроме этого, алгебраические уравнения связей также приводятся к дифференциальному виду.

Далее в разделах \ref{sect:track_omni} и \ref{sect:track_mecanum} подробно описаны геометрические построения для вывода уравнений\upr{mo:mo_cstr} в задаче о движении экипажа с омни- и \textit{mecanum}- колесами.
