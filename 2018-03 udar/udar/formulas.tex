
% \newcommand{\imm}[1]{ \ifmmode #1 \fi }

% ------------------------------------------------------------------
% SYMBOLS
% ------------------------------------------------------------------

\newcommand{\q}{\mathbf{q}}
\newcommand{\qdo}{\q^-}
\newcommand{\qposle}{\q^+}

\newcommand{\dotq}{\dot{\mathbf{q}}}
\newcommand{\dqdo}{\dotq^-}
\newcommand{\dqposle}{\dotq^+}

\newcommand{\nuvec}{\vec{\nu}}
\newcommand{\nudo}{\nuvec^-}
\newcommand{\nuposle}{\nuvec^+}

\newcommand{\subspace}{\widetilde{V}}
\newcommand{\deltadq}{\Delta\dotq}

\newcommand{\cstr}{\mathbf{V}}
\newcommand{\mke}{\mathbf{M}}

\newcommand{\dotp}[2]{\left( #1, \enspace #2 \right)}
\newcommand{\inv}[1]{\left( #1 \right)^{-1}}

\newcommand{\ke}{\mathbf{T}}

\newcommand{\mK}{\mathbf{K}}
\newcommand{\mvk}{\left(\mathbf{M}\mathbf{V} \enspace -\mK\right)}

\newcommand{\Q}{\mathbf{Q}}
\newcommand{\F}{\mathbf{F}}

% ------------------------------------------------------------------
% EQUATIONS
% ------------------------------------------------------------------

% Impact -- classical

\newcommand
{ \eqDeltaqQ }
{ \mathbf{M} (\dot{\mathbf{q}}^+ - \dot{\mathbf{q}}^-) = \mathbf{Q} }

\newcommand
{ \eqQKF }
{ \mathbf{Q} = \mathbf{K}\mathbf{F} }

\newcommand
{ \eqqnu }
{ \dqdo = \mathbf{V}\nuposle }

\newcommand
{ \eqMVnuKF }
{ \mathbf{M}\mathbf{V}\nuposle - \mathbf{K}\mathbf{F} = \mathbf{M}\dqdo }

\newcommand{\nuFT}{\left(\nuposle \enspace \mathbf{F}\right)^T}

\newcommand
{ \eqMVnuKFmat }
{ \mvk \nuFT = \mathbf{M}\dqdo }

\newcommand
{ \eqMVnuKFmatres }
{ \nuFT = \mvk^{-1} \mke\dqdo }

% Impact -- analytical

\newcommand
{ \eqDelta }
{ -\deltadq = \dqdo - \cstr\nuposle }

\newcommand
{ \logicDeltaOrth }
{ 0 = \dotp{\deltadq}{\mke\cstr} = \dotp{\cstr\nuposle - \dqdo}{\mke\cstr} = \dotp{\mke\cstr\nuposle - \mke\dqdo}{\cstr} = \cstr^T\mke\cstr\nuposle - \cstr^T\mke\dqdo }

\newcommand
{ \eqnuposleproj }
{ \nuposle = \inv{\cstr^T\mke\cstr}\cstr^T\mke\dqdo }

% Energy

\newcommand
{ \eqTquad }
{ \ke = \ddfrac{1}{2}\dotp{\mke\dotq}{\dotq} }

\newcommand
{ \eqDqVnu }
{ \dqposle = \cstr\nuposle }

\newcommand
{ \edQposleDelta }
{ \dqposle = \dqdo + \deltadq }

\newcommand
{ \eqDqposleInSubspace }
{ \dqposle \in \subspace }

\newcommand
{ \eqDeltaOrth }
{ \deltadq \perp_\mke \subspace }

\newcommand
{ \edMkeSim }
{ \mke = \mke^T }

\newcommand
{\logicWorkZero}
{\dotp{\mke\dqposle}{\deltadq} = \dotp{\mke\deltadq}{\dqposle} = \dotp{\mathbf{P}}{\dqposle} = 0}

\newcommand
{\logicDeltaT}
{ 2\Delta\ke & = & 2\left(\ke^+ - \ke^-\right) = \dotp{\mke\dqposle}{\dqposle} - \dotp{\mke\dqdo}{\dqdo} = \dotp{\mke\deltadq}{\deltadq} + 2\dotp{\mke\dqdo}{\deltadq} \\
 & = & -\dotp{\mke\deltadq}{\deltadq} + 2\dotp{\mke\dqposle}{\deltadq} = -\dotp{\mke\deltadq}{\deltadq} }

\newcommand
{\eqDeltaT}
{ \Delta\ke = -\ddfrac{1}{2}\dotp{\mke\deltadq}{\deltadq} < 0 }

% ------------------------------------------------------------------
% EXPLICIT EXPRESSIONS
% ------------------------------------------------------------------

\newcommand
{\K}
{
\begin{pmatrix}
1 & 0 & 1 & 0 & 1 & 0\cr
0 & 1 & 0 & 1 & 0 & 1\cr
-\mathrm{sin}\left( \theta+{\alpha_1}\right)  R & \mathrm{cos}\left( \theta+{\alpha_1}\right)  R & -\mathrm{sin}\left( \theta+{\alpha_2}\right)  R & \mathrm{cos}\left( \theta+{\alpha_2}\right)  R & -\mathrm{sin}\left(\theta+{\alpha_3}\right)  R & \mathrm{cos}\left(\theta+{\alpha_3}\right)  R \cr
-l \mathrm{sin}\left(\theta+{\alpha_1}\right)  & l \mathrm{cos}\left(\theta+{\alpha_1}\right)  & 0 & 0 & 0 & 0\cr
0 & 0 & -l \mathrm{sin}\left(\theta+{\alpha_2}\right)  & l \mathrm{cos}\left(\theta+{\alpha_2}\right)  & 0 & 0\cr 0 & 0 & 0 & 0 & -l \mathrm{sin}\left(\theta+{\alpha_3}\right)  & l \mathrm{cos}\left(\theta+{\alpha_3}\right) \cr
-\rho_1  \mathrm{cos}\left(\theta+{\alpha_1}\right)  & -\rho_1  \mathrm{sin}\left(\theta+{\alpha_1}\right)  & 0 & 0 & 0 & 0\cr
0 & 0 & -\rho_2  \mathrm{cos}\left(\theta+{\alpha_2}\right)  & -\rho_2  \mathrm{sin}\left(\theta+{\alpha_2}\right)  & 0 & 0\cr
0 & 0 & 0 & 0 & -\rho_3  \mathrm{cos}\left(\theta+{\alpha_3}\right)  & -\rho_3  \mathrm{sin}\left(\theta+{\alpha_3}\right)
\end{pmatrix}
}

\newcommand {\eqQiOne} { \Q^i_1 & = & \F^i_x }
\newcommand {\eqQiTwo} { \Q^i_2 & = & \F^i_y }
\newcommand {\eqQiTheta} { \Q^i_\theta & = & R \left(-\F^i_x\sin(\theta + \alpha_i) + \F^i_y\cos(\theta + \alpha_i)\right) }
\newcommand {\eqQChii} { \Q_{\chi_i} & = & \ddfrac{l}{R} \Q^i_\theta }
\newcommand {\eqQPhii} { \Q_{\phi_i} & = & -\rho_i \left( \F^i_x\cos(\theta + \alpha_i) + \F^i_y\sin(\theta + \alpha_i) \right) }
\newcommand {\eqQs} { \Q_s & = & 0 }
\newcommand {\eqQ} { \Q = \left( \enspace \sum_{i=1}^N \Q^i_1, \enspace \sum_{i=1}^N \Q^i_2, \enspace \sum_{i=1}^N \Q^i_\theta, \enspace \Q_{\chi_i}|_{i=1}^N, \enspace \Q_{\phi_i}|_{i=1}^N, \enspace \Q_s \enspace \right)^T }
