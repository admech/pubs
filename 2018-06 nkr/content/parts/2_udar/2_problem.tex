
\section{Постановка задачи}

\begin{figure}[h]
    \minipage{0.4\textwidth}
        \centering
        \asyinclude{./content/pic/asy/pic_cart.asy}
        \caption{Экипаж}
        \label{fig:vehicle}
    \endminipage
    \minipage{0.3\textwidth}
        \centering
        \asyinclude{./content/pic/asy/pic_wheel.asy}
        \caption{Колесо}
        \label{fig:wheel}
    \endminipage
    \minipage{0.3\textwidth}
        \centering
        \asyinclude{./content/pic/asy/pic_overlap.asy}
        \caption{Перекрытие}
        \label{fig:overlap}
    \endminipage
\end{figure}

Экипаж с омни-колесами как система абсолютно твердых тел включает платформу, $N$ омни-колес, оси которых горизонтальны и фиксированы относительно платформы, и $n$ массивных роликов на каждом колесе, то есть система состоит из $1 + N(n+1)$ тел. Будем рассматривать конфигурации экипажа, в которых оси колес коллинеарны векторам $SP_i$, соединяющим центр масс платформы $S$ и центры колес $P_i$ (фиг.~\ref{fig:vehicle}), причем $P_i$ расположены в вершинах правильного многоугольника так что $SP_i = R$. Оси роликов лежат в плоскости колеса на касательных к его окружности (фиг.~\ref{fig:wheel}). Трения в осях роликов и колес нет.
Обозначим углы между радиус-вектором $\mathbf{SP}_1$ и радиус-векторами $\mathbf{SP}_i$ центров колес $\alpha_i$ (при этом $\alpha_1 = 0$).
В таких конфигурациях центр платформы $S$ является и центром масс всей системы (и потому $\sum\limits_{k} \cos\alpha_k = \sum\limits_{k}\sin\alpha_k = 0$).

Рассмотрим движение экипажа по абсолютно шероховатой горизонтальной плоскости. Неподвижную систему отсчета выберем, направив ось $OZ$ вверх, и введя оси $OX$ и $OY$ на опорной плоскости.
Также жестко свяжем с платформой экипажа подвижную систему отсчета $S\xi\eta Z$ так, чтобы горизонтальная плоскость $S\xi\eta$ содержала центры колес $P_i$.
% Введем также три орта, жестко связанных с дисками колес: орт оси $i$-го колеса $\vec{n}_i = \vec{SP}_i/|\vec{SP}_i|$ и орты $\vec{n}_i^\perp$ и $\vec{n}_i^z$, лежащие в плоскости диска колеса, причем вектор $\vec{n}_i^z$ вертикален при нулевом повороте колеса $\chi_i$. Положения центров роликов на колесе определим углами $\kappa_j$ между ними и направлением, противоположным вектору $\vec{n}_i^z$. 
Введем обобщенные координаты:
$x, y$ -- координаты точки $S$ на плоскости $OXY$, $\theta$ -- угол между осями $OX$ и $S\xi$ (угол курса),
$\chi_i$ ($i = 1,\dots,N$) -- углы поворота колес вокруг их осей, отсчитываемые против часовой стрелки, если смотреть с конца вектора $\mathbf{SP}_i$, и $\phi_j$ -- углы поворота роликов вокруг их собственных осей.
Таким образом, вектор обобщенных координат имеет вид
$$\vec{q} = (
    x, y, \theta,
    \left.\{\chi_i\}\right|_{i=1}^N ,
    \left.\{\phi_k\}\right|_{k=1}^N,
    \left.\{\phi_s\}\right|_{s=1}^{N(n - 1)}
)^{\mathop{T}}\in\mathbb{R}^{3 + N(n+1)}$$ 
где сначала указаны углы поворота $\phi_k$ роликов, находящихся в данный момент в контакте с опорной плоскостью, a затем -- остальных, ``cвободных'', роликов. Индекс $s$ используется для сквозной нумерации свободных роликов и связан с номером колеса $i$ и ролика на колесе $j$ по формуле
\begin{equation}\label{eq:num}
    s(i, j) = (n-1)(i-1) + j - 1
\end{equation}

Введем псевдоскорости $$\vnu = (\nu_1, \nu_2, \nu_3, \nu_s), \quad \vec{v}_S = R\nu_1\vec{e}_\xi + R\nu_2\vec{e}_\eta, \quad \nu_3 = \Lambda\dot{\theta},\quad \nu_s = \dot{\phi}_s, \quad s = 1,\ldots,N(n-1),$$
где $\nu_1$, $\nu_2$ --- проекции скорости центра масс системы $S$ на оси $S\xi$ и $S\eta$, связанные с платформой, $\nu_3$ --- угловая скорость платформы (с точностью до множителя), $\nu_s$ --- скорости собственного вращения свободных роликов. Всего независимых псевдоскоростей $K = N(n-1)+3$. Таким образом, имеем
$$ \dot{x} = R \nu_1\cos\theta-R\nu_2\sin\theta, \hspace{15pt} \dot{y} = R\nu_1\sin\theta+R\nu_2\cos\theta$$

Поскольку опорная плоскость абсолютно шероховата, скольжения в контакте роликов не происходит, т.е.
скорости точек контакта $C_i$ равны нулю:
\begin{equation}\label{eq:constraints_vec}
    \vec{v}_{C_i} = 0,\quad i = 1,\dots, N,
\end{equation}
что в обобщенных координатах и псевдоскоростях имеет вид:
\begin{eqnarray}
\dot{\phi_k} &=& \frac{R}{\rho_k }(\nu_1\cos\alpha_k + \nu_2\sin\alpha_k); \quad \rho_k  = l\cos\chi_k - r \label{constraint_roller_contact}\\
\dot{\chi}_i &=& \frac{R}{l}(\nu_1\sin\alpha_i - \nu_2\cos\alpha_i - \frac{\nu_3}{\Lambda})\label{constraint_wheel_contact}
\end{eqnarray}
% Заметим, что знаменатель $\rho_k$ в формуле (\ref{constraint_roller_contact}) -- расстояние от оси ролика до точки контакта, обращающееся в нуль на стыке роликов (см. левую часть фиг.~\ref{fig:wheel}). Это обстоятельство приводит к разрывам второго рода функций в правых частях уравнений движения и будет рассмотрено отдельно ниже.
% Уравнение (\ref{constraint_wheel_contact}) совпадает с уравнением связи в случае безынерционной модели роликов. 

Таким образом, на систему наложены линейные дифференциальные связи:
\begin{equation}\label{constraints_V}
    \dot{\vec{q}} = \cstr\vnu,\quad \cstr = \cstr(\theta,\chi_i) = \begin{bmatrix}
        \widetilde{\cstr}  & \O_1  \\[6pt]
        \O_2       & \E         \\[6pt]
    \end{bmatrix},
    \quad
    \widetilde{\cstr} = \begin{bmatrix}
        R\cos\theta                    & -R\sin\theta                    & 0                      \\[6pt]
        R\sin\theta                    &  R\cos\theta                    & 0                      \\[6pt]
        0                              & 0                               & \ddfrac{1}{\Lambda}    \\[6pt]
        \ddfrac{R}{l}\sin\alpha_i      & -\ddfrac{R}{l}\cos\alpha_i      & -\ddfrac{R}{\Lambda l} \\[6pt]
        \ddfrac{R}{\rho_k}\cos\alpha_k &  \ddfrac{R}{\rho_k}\sin\alpha_k & 0                      \\[6pt]
    \end{bmatrix}
\end{equation}
Здесь $\O_1$ и $\O_2$ -- нулевые $(3+2n \times N(n-1))$- и $(N(n-1) \times 3)$-матрицы, $\E$ -- единичная матрица размерности $N(n-1)$.

Уравнения движения получим методом Я.В.~Татаринова для систем с дифференциальными связями (см. работы \cite{Tatarinov,Zobova2011}). Для получения замкнутой системы обыкновенных дифференциальных уравнений, к уравнениям движения добавим уравнения связей на $\dot{\chi}_i$. Подробный вывод уравнений движения для рассматриваемой модели экипажа, анализ структуры уравнений и моделирование участков движения без смены роликов в контакте см. в \cite{ZobovaGerasimovPMM}.
% :
% \begin{equation}\label{Tatarinov}
%     \frac{d}{dt}\frac{\partial L^{*}}{\partial \nu_\alpha}  + \{P_\alpha, L^{*}\} = \sum\limits_{\mu = 1}^{K}\{P_\alpha, \nu_\mu P_\mu\},\quad \alpha = 1,\dots, K,
% \end{equation}
% где $L^*$ -- лагранжиан с учетом связей (здесь и далее верхний индекс $*$ означает учет связей), $P_\alpha$ -- линейные комбинации формальных канонических импульсов $p_i$, определяемые из соотношения 
% $$\sum\limits_{\mu=1}^{K}\nu_\mu P_\mu \equiv \sum\limits_{i=1}^{N(n+1)+3}\dot{q_i} p_i$$
%  в котором $\dot{q}_i$ выражены через псевдоскорости $\nu_\mu$ в соответствии с формулами (\ref{constraints_V}); $\{\cdot, \cdot\}$ -- скобка Пуассона по $p_i$, $q_i$, после ее вычисления выполняется подстановка 
% $$\hspace{10pt} p_i = \frac{\partial L}{\partial \dot{q}_i}$$


% Так как потенциальная энергия системы во время движения не меняется, лагранжиан  равен кинетической энергии:
% \begin{equation}\label{kin_en}
%     2L = 2T = M\vec{v}_S^2 + I_S\dot{\theta}^2 + J\sum_i\dot{\chi}_i^2 + B\sum_{i,j}(\dot{\phi}_{ij}^2 + 2\dot{\theta}\sin(\kappa_j + \chi_i)\dot{\phi}_{ij})=\dot{\vec{q}}^\mathrm{T}\M\dot{\vec{q}}
% \end{equation}
% Здесь $M,\ I_S,\ J$ --- массово-инерционные характеристики экипажа (см. Приложение), $B$ --- момент инерции ролика относительно его оси вращения. Лагранжиан при учете связей определяется соотношением:
% $$ 2L^{*}  = \vnu^\mathrm{T} V^\mathrm{T}\M V\vnu = \vnu^\mathrm{T} \M^*(\chi_i)\vnu $$

% Матрица кинетической энергии:
% $$
% \M = \begin{bmatrix}
%     \widetilde{\M}_{11}   & \widetilde{\M}_{12}   & \widetilde{\M}_{13} \\
%     \widetilde{\M}_{12}^T & \widetilde{\M}_{22}   & \widetilde{\M}_{23} \\
%     \widetilde{\M}_{13}^T & \widetilde{\M}_{23}^T & \widetilde{\M}_{33} \\
% \end{bmatrix}
% $$
% где
% $$
% \widetilde{\M}_{11} = \text{diag}(M, M, I_S),
% \quad
% \widetilde{\M}_{22} = JE_{N \times N},
% \quad
% \widetilde{\M}_{33} = BE_{Nn \times Nn}
% $$
% $$
% \widetilde{\M}_{12} = O_{3 \times N},
% \quad
% \widetilde{\M}_{13} = \begin{bmatrix}
%         0                      & \cdots & 0                      \\
%         0                      & \cdots & 0                      \\
%         B\sin\chi_{11}         & \cdots & B\sin\chi_{Nn}         \\
%     \end{bmatrix},
% \quad
% \widetilde{\M}_{23} = O_{N \times Nn}
% \vsp
% $$
% Здесь $O_{(\boldsymbol{\cdot})}$ и $E_{(\boldsymbol{\cdot})}$ --- нулевые и единичные матрицы, в индексах которых указаны их размерности. В третьей строке $\widetilde{\M}_{13}$ сначала указаны элементы, соответствующие роликам, находящимся в контакте, а затем соответствующие ``свободным'' роликам; элементы упорядочены по возрастанию индексов, так что ролики одного колеса соседствуют.

Система допускает интеграл энергии $\frac{1}{2}\vnu^\mathrm{T}\M^*(\chi_i)\vnu = h = \mathrm{const}$ и первые интегралы:
\begin{equation}
    \label{int_free_roller}
\nu_s + \ddfrac{1}{\Lambda}\sin\chi_{ij}\nu_3 = \const
\end{equation}
связывающие скорость вращения платформы $\nu_3$ со скоростями собственного вращения свободных роликов (здесь $\chi_{ij}$ -- угол между опорной плоскостью $OXY$ и радиус-вектором центра $j$-го ролика на $i$-том колесе относительно центра колеса $P_i$).

В тех интервалах времени, когда ролик в контакте с опорной плоскостью не меняется, динамика системы описывается уравнениями движения системы (см. \cite{ZobovaGerasimovPMM}). Смена контакта на $i$-том колесе происходит при значении угла $\chi_i = \ddfrac{2\pi}{n}$. При этом, во-первых, правая часть уравнений движения терпит разрыв второго рода из-за равенства нулю выражений $\rho_i = l\cos\chi_i-r$ в знаменателе. Во-вторых, происходит мгновенное снятие и наложение связей: условие отсутствия проскальзывания для ролика, выходящего из контакта, снимается, и аналогичное ему мгновенно налагается на вновь входящий в контакт ролик.

На практике первое обстоятельство никогда не реализуется, поскольку оси роликов в реальных системах имеют ненулевую толщину, а значит, концы роликов усекаются. При этом ролики располагают рядами в двух и более плоскостях, чтобы в каждый момент гладкая сторона хотя бы одного ролика была в контакте с плоскостью. В данной работе рассматриваются усеченные ролики (см. фиг.~\ref{fig:overlap}), но их оси расположены в одной плоскости, и допускается пересечение тел роликов в пространстве. Ось ролика находится на расстоянии $r = l\cos\ddfrac{\pi}{n-1}$ от центра колеса. Ролик представляет собой тело вращения относительно этой оси дуги окружности радиуса $l$ с углом раствора $\ddfrac{2\pi}{n}$.