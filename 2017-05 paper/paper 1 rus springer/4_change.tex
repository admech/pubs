%\section{Переход между роликами}
{\bf 4. Переход между роликами.}
\stepcounter{section}
Уравнения (\ref{eq:full_system}) описывают динамику системы на промежутках времени, в течение которых не происходит смены роликов. 
При переходе любого колеса с одного ролика на другой коэффициенты уравнений терпят разрыв второго рода из-за выражений $\rho_i = l\cos\chi_i-r$ в знаменателе.

% \begin{figure}
%     \minipage{0.5\textwidth}
%         \centering
%         \asyinclude{./asy/pic_overlap.asy}
%         \caption{Ролики перекрываются}
%         \label{fig:overlap}
%     \endminipage
%     \minipage{0.5\textwidth}
%         \centering
%         \asyinclude{./asy/pic_change.asy}
%         \caption{Переход между роликами}
%         \label{fig:change}
%     \endminipage
% \end{figure}

Заметим, что в технических реализациях омни-колес ситуация $\rho_i = 0$ никогда не имеет места, т.к. концы роликов усекаются (в частности, потому что оси роликов в реальных системах имеют ненулевую толщину и должны быть закреплены в колесах). Для того, чтобы в каждый момент в контакте между колесом и плоскостью был ролик, их располагают в два или больше рядов. %Это приводит, впрочем, к скачкам расстояния между точкой контакта и центром масс ситемы в моменты смены роликов.

Для исследования движений, на которых происходят смены контактных роликов, примем следующие предположения. Усечем ролики (см. рис.~\ref{fig:overlap}), но оставим их оси в одной плоскости, допуская пересечение тел роликов в пространстве и пренебрегая им. Переход между роликами одного колеса будет происходить при значении угла $\chi_i = \frac{2\pi}{n}$. Колесо с усеченными роликами определим, располагая ось ролика на расстоянии $r = l\cos\frac{\pi}{n-1}$ от центра колеса
%(знаменатель на единицу меньше количества роликов)
, а его поверхность задавая как фигуру вращения дуги окружности радиуса $l$ с углом раствора $\frac{2\pi}{n}$ вокруг этой оси, замкнутую соответствующими дисками.

Кроме этого, при смене контакта происходит мгновенное наложение связи на вновь вошедший в контакт ролик и снятие её с освободившегося, после чего последний может свободно вращаться вокруг своей оси. При смене роликов в реальной системе происходят взаимодействия типа ударных, в том числе проскальзывание роликов относительно плоскости. Моделирование этих эффектов не рассматривается в настоящей статье. В безынерционной модели ($B = 0$) скорости $\nu_1$, $\nu_2$, $\nu_3$, описывающие движение платформы, демонстрируют гладкое поведение, и добавляя массу роликов на участках между сменами контакта, мы сохраним это свойство в моменты смен и будем считать, что скорости $\nu_1$, $\nu_2$, $\nu_3$ при переходе с ролика на ролик не изменяются. При существенном превышении массы платформы над массами роликов такое предположение представляется разумным. Из уравнений (\ref{constraint_roller_contact}, \ref{constraint_wheel_contact}) получим, что ролик, входящий в контакт, мгновенно приобретает ту же угловую скорость, что и освобождающийся ролик.

Таким образом, при переходе ($\chi_i = \chi_i^+$) сохраним значения $\nu_1$, $\nu_2$, $\nu_3$, заменим $\chi_i$ с $\chi_i^+$ на $\chi_i^-$ (см. рис.~\ref{fig:change}), и выполним с псевдоскоростями $\nu_s$ следующее преобразование. Пусть $\vec{\nu_i^s} = (\nu_{i2},\ldots,\nu_{in})$ -- псевдоскорости свободных роликов на колесе $i$. Тогда если при смене контакта $\dot{\chi_i} > 0$ (т.е. колесо поворачивается против часовой стрелки, см. рис.~\ref{fig:wheel}), то отбросим $\nu_{in}$, остальные компоненты $\vec{\nu_i^s}$ перенумеруем, сдвигая их вперед: $\nu_{ij} \rightarrow \nu_{ij+1}$, а $\nu_{i2}$ положим равной значению правой части в уравнении связи\upr{constraint_roller_contact}. При вращении колеса в другую сторону, выполним аналогичные преобразования, сдвиг номеров роликов при этом проиходит назад.
