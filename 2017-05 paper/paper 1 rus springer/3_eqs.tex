%\section{Уравнения движения}
{\bf 3. Уравнения движения.}
\stepcounter{section}
Воспользуемся лаконичным методом получения уравнений движения для систем с дифференциальными связями, предложенным Я.В.~Татариновым \cite{Tatarinov}:
\begin{equation}\label{Tatarinov}
    \frac{d}{dt}\frac{\partial L^{*}}{\partial \nu_\alpha}  + \{P_\alpha, L^{*}\} = \sum\limits_{\mu = 1}^{K}\{P_\alpha, \nu_\mu P_\mu\},\quad \alpha = 1,\dots, K
\end{equation}
Здесь $L$ -- лагранжиан, $L^*$ -- он же с учетом связей (здесь и далее верхний индекс $*$ означает учет связей), $P_\alpha$ -- линейные комбинации формальных канонических импульсов $p_i$, определяемые из соотношения 
$$\sum\limits_{\mu=1}^{K}\nu_\mu P_\mu \equiv \sum\limits_{i=1}^{N(n+1)+3}\dot{q_i} p_i$$
 в котором $\dot{q}_i$ выражены через псевдоскорости $\nu_\mu$ в соответствии с формулами (\ref{constraints_V}); $\{\cdot, \cdot\}$ -- скобка Пуассона по $p_i$, $q_i$, после ее вычисления выполняется подстановка 
$$\hspace{10pt} p_i = \frac{\partial L}{\partial \dot{q}_i}$$
(Подробности см. в работах \cite{Tatarinov,Zobova2011}.)

Так как потенциальная энергия системы во время движения не меняется, лагранжиан  равен кинетической энергии:
\begin{equation}\label{kin_en}
    2L = 2T = M\vec{v}_S^2 + I_S\dot{\theta}^2 + J\sum_i\dot{\chi}_i^2 + B\sum_{i,j}(\dot{\phi}_{ij}^2 + 2\dot{\theta}\sin(\kappa_j + \chi_i)\dot{\phi}_{ij})=\dot{\vec{q}}^\mathrm{T}\M\dot{\vec{q}}
\end{equation}
%\sout{Здесь полная масса системы -- $M = \mathring{M} + Nnm$, момент инерции всей системы относительно $SZ$ -- $I_S = \mathring{I_S} + Nn(\frac{A+B}{2} + mR^2 + \frac{mr^2}{2})$, момент инерции колеса (с роликами) относительно его оси $J = \mathring{J} + n(A + mr^2)$, где $\mathring{M}, \mathring{I_S}, \mathring{J}$ -- масса и моменты инерции системы и колес без учета роликов; $m$ -- масса ролика; $A$ -- момент инерции ролика относительно любой оси, перпендикулярной его оси собственного вращения и проходящей через его центр масс; $r$ -- радиус диска колеса (расстояние от центра колеса до центра ролика),}
Здесь $M,\ I_S,\ J$ --- массово-инерционные характеристики экипажа (см. Приложение), $B$ --- момент инерции ролика относительно его оси вращения. Лагранжиан при учете связей определяется соотношением:
$$ 2L^{*}  = \vnu^\mathrm{T} V^\mathrm{T}\M V\vnu = \vnu^\mathrm{T} \M^*(\chi_i)\vnu $$
Структура симметрической матрицы $\M^*$ следующая:
$$
\M^* = 
    \begin{bmatrix}
        \widetilde{\M}^*_{11} & \widetilde{\M}^*_{12} \\
        \widetilde{\M}^{*T}_{12} & \widetilde{\M}^*_{22} \\[4pt]
    \end{bmatrix}
\vsp
$$
$$
\widetilde{\M}^*_{11} = 
    \left(
        m^*_{ij}
    \right)_{3\times3},
\qquad
\widetilde{\M}^*_{22} = 
    BE_{N(n-1) \times N(n-1)}
\vsp
$$
$$
\widetilde{\M}^*_{12} = 
    \begin{bmatrix}
        0&\ldots& 0 \\
        0&\ldots&0 \\
        B\Lambda^{-1}\sin\chi_{12}&\ldots& B\Lambda^{-1}\sin\chi_{Nn}\\[4pt]
    \end{bmatrix}_{3\times N(n-1)}
\vsp
$$
Здесь $E_{N(n-1) \times N(n-1)}$ --- единичная матрица, $\chi_{kl} = \chi_k+\kappa_l$ --- угол между вертикалью и осью ролика, где индекс $k = 1,\dots,N$ означает номер колеса, $l = 2,\ldots, n$ -- номер cвободного ролика на колесе ($l = 1$ --- ролик, находящийся в контакте).

% $$
% \M^* = \begin{bmatrix}
%         \left(\begin{matrix}&&\\&m^*_{ij}&\\&&\end{matrix}\right)_{3\times3} \quad & \left(\begin{matrix} 0&\ldots& 0 \\ 0&\ldots&0 \\ B\Lambda^{-1}\sin\chi_{12}&\ldots& B\Lambda^{-1}\sin\chi_{nN} \end{matrix}\right) \\[25pt]
%         \scalebox{1.5}{$\star$} & \begin{matrix} B & &0 \\ & \ddots & \\ 0& & B \end{matrix} \\
%     \end{bmatrix},
% $$

%\[ \M^* = \left[ \begin{array}{c|c}
%m^* & c \\ \cline{1-2}
%c^\mathrm{T} & b
%\end{array} \right] \]
Явные формулы для элементов матрицы $\widetilde{\M}^*_{11}$ выписаны в Приложении; отметим, что они зависят только от координат $\chi_i$, которые входят в отношения $B/\rho_i^2$ и $B\sin\chi_i/\rho_i$, имеющие разрывы второго рода при смене роликов, т.е. при переходе с одного ролика на другой (см. равенство (\ref{constraint_roller_contact})).
% Эта матрица соответствует псевдоскоростям $\nu_1,\ \nu_2,\ \nu_3$.
% Остальные элементы матрицы $\M^*$ соответствуют псевдоскоростям свободных роликoв $\nu_s$, для которых $\chi_{kl} = \chi_k+\kappa_l$ --- угол между вертикалью и осью ролика.

Первое слагаемое в левой части равенства (\ref{Tatarinov}) получается дифференцированием лагранжиана и подстановкой связей:
\begin{equation}\label{DLStarDnuDdt}
    \frac{d}{dt}\frac{\partial L^{*}}{\partial \vnu} = \frac{d}{dt}(\M^*(\chi)\vnu) = 
    \M^*(\chi)\dot{\vnu} +
    \frac{d}{dt}(\M^*(\chi))\vnu =
    \M^*(\chi)\dot{\vnu} +
    \sum_{i=1}^{N}\dot{\chi}_i^*\M^*_i\vnu
\end{equation}
где $\M^*_i = \ddfrac{\partial \M^*}{\partial \chi_i}.$ Обратим внимание, что компоненты векторов под знаком суммы, соответствующие свободным роликам, т.е. компоненты под номерами $\alpha = 4,\dots, K$, имеют вид $\dot{\chi}_i^*\nu_3B\Lambda^{-1}\cos\chi_{ij},$
где индексы $i,j$ соответствуют $\alpha$ по формуле $\alpha = 3 + s(i, j)$ (см. формулу\upr{eq:num}).

Имеем выражения:
\begin{equation}\label{P}
    \begin{array}{rcl}
        P_1 & = & R\bigg(p_x\cos\theta + p_y\sin\theta + \sum\limits_{i}\bigg(\ddfrac{p_{\chi_i}}{l}\sin\alpha_i +  \ddfrac{p_{\phi_{i1}}}{\rho_i}\cos\alpha_i\bigg)\bigg)\vsp
        P_2 & = & R\bigg(-p_x\sin\theta + p_y\cos\theta + \sum\limits_{i}\bigg(-\ddfrac{p_{\chi_i}}{l}\cos\alpha_i +  \ddfrac{p_{\phi_{i1}}}{\rho_i}\sin\alpha_i\bigg)\bigg)\vsp
        P_3 & = & \ddfrac{1}{\Lambda}\bigg(p_\theta - \sum\limits_{i}\ddfrac{R}{l}p_{\chi_i}\bigg)\vsp
        P_s & = & p_{\phi_s}
    \end{array}
\end{equation}

Поскольку коэффициенты  лагранжиана $L^{*}$ зависят только от координаты $\chi_i$, его скобки Пуассона с $P_1$, $P_2$, $P_3$  --- квадратичные формы псевдоскоростей, пропорциональные моменту инерции ролика $B$ с коэффициентами, зависящими от $\chi_i$:
$$
\{P_1, L^*\} = -\frac{\partial P_1}{\partial p_{\chi_i}}\frac{\partial L^*}{\partial \chi_i} = -\frac{R}{2l}\vnu^\mathrm{T}\M^*_i\vnu\sin\alpha_i,
$$
$$
\{P_2, L^*\} = \frac{R}{2l}\vnu^\mathrm{T}\M^*_i\vnu\cos\alpha_i,\  
\{P_3, L^*\} = \frac{R}{2l\Lambda}\vnu^\mathrm{T}\M^*_i\vnu,\quad \{P_s,L^*\} = 0, s>3
$$

Остается рассмотреть правую часть равенства (\ref{Tatarinov}): она отлична от нуля лишь при $\alpha = 1,\ 2,\ 3$ (см. Приложение).
%, и после подстановки формальных импульсов $p_i$ их можно записать 

%как $$\ddfrac{MR^2}{\Lambda}(\nu_2\nu_3, -\nu_1\nu_3, 0, 0, \ldots, 0)^T - BR^2 \vnu^T (\Prhs_\alpha)^T \vnu,$$ где матрицы $\Prhs_\alpha$ квадратичных форм задаются следующим образом:

%$$
%\tau_k = \ddfrac{\sin\chi_k}{\rho_k^2}, \quad s_k = ( %R\frac{\cos\alpha_k}{\rho_k}, R\frac{\sin\alpha_k}{\rho_k}, %\frac{1}{\Lambda}\sin\chi_k )\tau_k,
%$$
%$$
%u_k = ( 1, \frac{1}{\Lambda}\cos\alpha_k, \frac{1}{\Lambda}\sin\alpha_k ), %\quad \AntiU_k = \left(\begin{matrix}
%    0      & u_k^1  & u_k^2\\
%    -u_k^1 & 0      & u_k^3\\
%    -u_k^2 & -u_k^3 & 0    \\
%\end{matrix}
%\right),
%$$
%$$
%(\Prhs_\alpha)_{ij} = \sum_k (\AntiU_k)_{\alpha j}s^i_k, i,j \leq 3; \quad %(\Prhs_\alpha)_{ij} = 0, i,j > 3; \quad \Prhs_\alpha = 0, \alpha > 3. \\
%$$
%Более подробные выражения для $p_i$ и $\{P_i, P_j\}$ см. в приложении.

Окончательно, пользуясь обозначениями из Приложения, получаем, что уравнения\upr{Tatarinov} имеют следующую структуру:
% \def\superDuperSubscript{\the\fontdimen16\textfont2} -- could not use the variable below
\begin{eqnarray*}
\M^*\dot{\vnu} = 
MR^2\Lambda^{-1}\left(\begin{matrix}
    \nu_2\nu_3\\
    -\nu_1\nu_3\\
    0\\
    0\\
    \vdots
    \\
    0
\end{matrix}\right)
+\vnu^\mathrm{T}\left(
\frac{R}{2l}
\left(\begin{matrix}
    -\M^*_i \sin\alpha_i\\
    \M^*_i \cos\alpha_i\\
    \M^*_i \Lambda^{-1}\\
    0\\
    \vdots
    \\
    0
    \end{matrix}
\right)
-BR^2
\left(\begin{matrix}
    \Prhs_1\\
    \Prhs_2\\
    \Prhs_3\\
    0\\
    \vdots
    \\
    0
\end{matrix}\right)
\right)
\vnu
-B\left(\begin{matrix}
    \scalebox{1.5}{$\star$}\\
    \scalebox{1.5}{$\star$}\\
    \scalebox{1.5}{$\star$}\\
    \fontdimen16\textfont2=5pt
    \ddfrac{\nu_3}{\Lambda}\dot{\chi}_1^*\cos\chi_{12}\\
    \vdots
    \\
    \ddfrac{\nu_3}{\Lambda}\dot{\chi}_N^*\cos\chi_{Nn}
\end{matrix}\right)
\end{eqnarray*}
\begin{equation}\label{eq:full_system}
\end{equation}
\fontdimen16\textfont2=1.79999pt
Символ $\star$ в последнем слагаемом правой части уравнений для $\alpha = 1,2,3 $ заменяет выражения из второго слагаемого (\ref{DLStarDnuDdt}). Матрицы $\Prhs_\alpha$ размера $K\times K$ составлены из строк $\prhs_{\alpha\beta}$, определенных в Приложении и зависящих от геометрии экипажа и углов поворота колес $\chi_i$:
$$ 
\Prhs_1 = \left(
\begin{matrix}
 \vec{0} \\
 \prhs_{12}\\
\prhs_{13}\\
\vec{0}\\
\vdots\\
\vec{0}
\end{matrix}
\right),\quad
\Prhs_2 = \left(
\begin{matrix}
-\prhs_{12}\\
\vec{0}\\
\prhs_{23}\\
\vec{0}\\
\vdots\\
\vec{0}
\end{matrix}
\right),
\Prhs_3 = \left(
\begin{matrix}
-\prhs_{13}\\
-\prhs_{23}\\
\vec{0}\\
\vec{0}\\
\vdots\\
\vec{0}
\end{matrix}
\right)
$$
Поскольку матрицы $\M^*_i$ и $\Prhs_\alpha$ зависят от углов поворота колес $\chi_i$, для замыкания системы к этим уравнениям надо добавить уравнения
(\ref{constraint_wheel_contact}).

Структура уравнений позволяет выявить следующие свойства.
\begin{enumerate}[wide]
    \item Система допускает интеграл энергии $\frac{1}{2}\vnu^\mathrm{T}\M^*(\chi_i)\vnu = h = \mathrm{const}$ в силу общей теоремы об изменении полной механической энергии: так как система стеснена автономными идеальными связями, а силы консервативны, то полная энергия (в рассматриваемом здесь случае она равна кинетической энергии) сохраняется.
    % Доказательство этого факта можно провести двумя способами. Первый основан на общей теореме об изменении полной механической энергии: так как система стеснена автономными идеальными связями, а силы консервативны, то полная энергия (в нашем случае она равна кинетической энергии) сохраняется. Второй способ основан на стандартном приеме: умножение каждого из уравнений на $\nu_\alpha$ и их сложение. Действительно, левая часть вместе со второй группой слагаемых в правой части дадут полный дифференциал выражения $\vnu^\mathrm{T}\M^*(\chi_i)\vnu$, так как $\sum\limits_{\alpha}\{\nu_\alpha P_\alpha, L^*\} = \vnu^\mathrm{T} \frac{\partial\M^*}{\partial \chi_i}\dot{\chi_i}\vnu$. Слагаемые из правой части уравнений (\ref{Tatarinov}) при суммировании дадут тождественный ноль: $\sum\limits_{\alpha,\mu}\{\nu_\alpha P_\alpha, \nu_\mu P_\mu\} = 0$.
    
    \item Если платформа экипажа неподвижна, т.е. $\nu_1 = \nu_2 = \nu_3 = 0$, свободные ролики сохраняют свою начальную угловую скорость: $\nu_s = \mathrm{const}$, чего и следовало ожидать.
   
    % \item Cистема допускает частное решение $\nu_1= 0, \nu_2 = 0, \nu_3 = const, \nu_s = 0$ --- равномерное вращение вокруг вертикальной оси проходящей через центр масс, при котором ни один ролик не вращается вокруг своей оси. Действительно, левая часть и первое слагаемое правой обращаются в ноль.
    % Вторая группа слагаемых правой части равна нулю, т.к. из \upr{mstar} $\frac{\partial m^*_{33}}{\partial \chi_i} = 0$. Третья группа слагаемых принимает вид
    % $$\nu_3^2\sum_{k}(\cos\alpha_k, \sin\alpha_k, 0, 0, \ldots, 0)^\mathrm{T}\ddfrac{\sin^2\chi_k}{\Lambda^2\rho^2_k}$$
    % Так как из (\ref{constraint_wheel_contact}) $\dot\chi_k = -R(l\Lambda)^{-1}\nu_3$, то в случае одинаковых начальных условий для всех колес, функции $\chi_k$ и $\rho_k$ для всех колес совпадают. Вынося этот множитель за знак суммы и исходя из геометрии экипажа ($\sum_k\cos\alpha_k =  \sum_k\sin\alpha_k = 0$), получим ноль в правой части.
    \item При $B = 0$ все слагаемые в правой части равенства~(\ref{eq:full_system}), кроме первого, обращаются в нуль, как и все члены, соответствующие свободным роликам, в левой части (см. Приложение, равенства\upr{mstar}). В этом случае существенными остаются первые три уравнения системы\upr{Tatarinov} относительно $\nu_1,\ \nu_2,\ \nu_3$, описывающие динамику безынерционной модели экипажа \cite{ZobovaTatarinovPMM}.
    \item Существовавший в безынерционной модели линейный первый интеграл разрушается для модели с массивными роликами. При $B = 0$ он имеет вид $m_{33}^*\nu_3 = \mathrm{const}$ (причем $m_{33} = \mathrm{const}$) и следует непосредственно из третьего уравнения системы\upr{Tatarinov}. При $B\neq 0$ скорость изменения $\nu_3$ пропорциональна моменту инерции ролика~$B$.
    \item Поскольку скобки Пуассона в уравнениях для свободных роликов равны нулю, система допускает первые интегралы:
    \begin{equation}
        \label{int_free_roller}
    \nu_s + \ddfrac{1}{\Lambda}\sin\chi_{ij}\nu_3 = \const
    \end{equation}
    Скорость вращения платформы $\nu_3$ связана со скоростями собственного вращения свободных роликов. В частности, вращение экипажа вокруг вертикальной оси, проходящей через его центр ($\nu_1(0) = 0, \nu_2(0) = 0, \nu_3(0) \neq 0$), неравномерно, в отличие от выводов, основанных на безынерционной модели.
    \item Одновременное изменение начальных значений всех псевдоскоростей $\vnu \rightarrow \lambda\vnu, \lambda \neq 0$ умножением на число, отличное от нуля, эквивалентно замене времени $t \rightarrow \lambda t$.
\end{enumerate}

